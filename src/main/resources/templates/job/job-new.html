<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>ê³µê³  ë“±ë¡</title>
    <link rel="stylesheet" th:href="@{/css/mypage.css}" />
    <link rel="stylesheet" th:href="@{/css/layout.css}" />
</head>
<body>
<!--<p th:text="'í˜„ì¬ userType: ' + ${userType}"></p>-->
<div th:replace="~{fragments/header :: header(role=${role})}"></div>

<div class="container">
    <h2>ì±„ìš© ê³µê³  ë“±ë¡</h2>

    <form th:action="@{/job/new}" method="post" th:object="${job}">
<!--        <input type="hidden" name="companyId" th:value="${job.companyId}" />-->

        <div class="form-group">
            <label>ê´€ì‹¬ ì§ë¬´</label>
            <input type="hidden" th:field="*{occupationId}" id="occupationId" />
            <div id="react-job-category-selector"></div>
        </div>

        <div class="form-group">
            <label>ì œëª©</label>
            <input type="text" th:field="*{title}" required />
            <div th:if="${#fields.hasErrors('title')}" class="error-message" th:errors="*{title}"></div>
        </div>

        <div class="form-group">
            <label>ì„¤ëª…</label>
            <textarea th:field="*{description}" rows="5" required ></textarea>
            <div th:if="${#fields.hasErrors('description')}" class="error-message" th:errors="*{description}"></div>
        </div>

        <div class="form-group">
            <label>ì£¼ì†Œ</label>
            <input type="text" th:field="*{address}" required />
            <div th:if="${#fields.hasErrors('address')}" class="error-message" th:errors="*{address}"></div>
        </div>

        <div class="form-group">
            <label>ì£¼ìš” ì—…ë¬´</label>
            <textarea th:field="*{mainTask}" rows="2" required ></textarea>
            <div th:if="${#fields.hasErrors('mainTask')}" class="error-message" th:errors="*{mainTask}"></div>
        </div>

        <div class="form-group">
            <label>í•„ìš” ê¸°ìˆ </label>
            <textarea th:field="*{requiredSkills}" rows="2" required ></textarea>
            <div th:if="${#fields.hasErrors('requiredSkills')}" class="error-message" th:errors="*{requiredSkills}"></div>
        </div>

        <div class="form-group">
            <label>í•„ìš” ì„±í–¥</label>
            <textarea th:field="*{requiredTraits}" rows="2" required ></textarea>
            <div th:if="${#fields.hasErrors('title')}" class="error-message" th:errors="*{requiredTraits}"></div>
        </div>

        <div class="form-group">
            <label>ê¸°ìˆ  í‚¤ì›Œë“œ</label>
            <input type="text" th:field="*{skillKeywords}" />
            <div th:if="${#fields.hasErrors('skillKeywords')}" class="error-message" th:errors="*{skillKeywords}"></div>
        </div>

        <div class="form-group">
            <label>ì„±í–¥ í‚¤ì›Œë“œ</label>
            <input type="text" th:field="*{traitKeywords}" />
            <div th:if="${#fields.hasErrors('traitKeywords')}" class="error-message" th:errors="*{traitKeywords}"></div>
        </div>

        <input type="hidden" th:field="*{latitude}" value="37.5665" />
        <input type="hidden" th:field="*{longitude}" value="126.9780" />

        <div class="form-group">
            <label>ì‹œì‘ì¼</label>
            <input type="date" th:field="*{startDate}" th:value="${#temporals.format(job.startDate, 'yyyy-MM-dd')}" required />
            <div th:if="${#fields.hasErrors('startDate')}" class="error-message" th:errors="*{startDate}"></div>
        </div>

        <div class="form-group">
            <label>ì¢…ë£Œì¼</label>
            <input type="date" th:field="*{endDate}" th:value="${#temporals.format(job.endDate, 'yyyy-MM-dd')}" required />
            <div th:if="${#fields.hasErrors('endDate')}" class="error-message" th:errors="*{endDate}"></div>
        </div>

        <div class="form-group">
            <label>ì´ë©”ì¼</label>
            <input type="email" th:field="*{enrollEmail}" required />
            <div th:if="${#fields.hasErrors('enrollEmail')}" class="error-message" th:errors="*{enrollEmail}"></div>
        </div>

        <div class="form-group">
            <label>ì•ˆë‚´ì‚¬í•­</label>
            <textarea th:field="*{notice}" rows="2"></textarea>
        </div>

<!--        <div class="form-group">-->
<!--            <label for="attachment">ì²¨ë¶€íŒŒì¼</label>-->
<!--            <input type="file" id="attachment" name="attachment" class="form-control" />-->
<!--        </div>-->

        <div class="button-group" style="margin-top: 20px; display: flex; gap: 16px;">
            <button type="submit" class="btn btn-primary">ë“±ë¡</button>
            <button type="button" class="btn btn-primary" onclick="location.href='/job/manage-jobs'">ë“±ë¡ ì·¨ì†Œ</button>
            <button type="button" class="btn btn-secondary" onclick="analyzeJob()">AI ê³µê³ ë¶„ì„</button>
            <button type="button" class="btn btn-secondary" onclick="generatePoster()">í¬ìŠ¤í„° ìƒì„±í•˜ê¸°</button>
        </div>
    </form>
</div>

<script th:src="@{/js/dropdown.js}"></script>
<script th:src="@{/js/logout.js}"></script>

<!-- ğŸ”½ í•˜ë‹¨ì— script ìœ„ì¹˜ (ê¸°ì¡´ ìœ„ì¹˜ì™€ ê°™ê²Œ ìœ ì§€) -->
<script th:src="@{/js/dropdown.js}"></script>
<script th:src="@{/js/logout.js}"></script>

<!-- React + ReactDOM CDN -->
<script type="module">
    import React from "https://cdn.jsdelivr.net/npm/react@18.2.0/+esm";
    import { createRoot } from "https://cdn.jsdelivr.net/npm/react-dom@18.2.0/client/+esm";

    window.React = React;
    window.createRoot = createRoot;

    // React ì»´í¬ë„ŒíŠ¸ë¥¼ DOMì´ ë¡œë“œëœ ì´í›„ ì‹¤í–‰
    document.addEventListener("DOMContentLoaded", () => {
        import("/js/JobCategorySelector.js").then((mod) => {
            const container = document.getElementById("react-job-category-selector");
            if (container) {
                const root = createRoot(container);
                root.render(React.createElement(mod.default));
            }
        });

        // âœ… Form ì œì¶œ ì „ì— occupationId ê°’ì´ ì œëŒ€ë¡œ ë“¤ì–´ê°”ëŠ”ì§€ ê²€ì¦
        const form = document.querySelector("form");
        if (form) {
            form.addEventListener("submit", function (e) {
                const occInput = document.getElementById("occupationId");
                if (!occInput || !occInput.value) {
                    alert("ì§ë¬´ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”!");
                    e.preventDefault(); // ì „ì†¡ ë°©ì§€
                } else {
                    console.log("âœ… ì„ íƒëœ occupationId:", occInput.value);
                }
            });
        }
    });
</script>

</body>
</html>
