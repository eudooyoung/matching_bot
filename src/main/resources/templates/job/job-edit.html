<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>공고 수정하기</title>
    <link rel="stylesheet" th:href="@{/css/mypage.css}"/>
    <link rel="stylesheet" th:href="@{/css/layout.css}"/>
    <style>
        .form-box {
            background-color: white;
            margin: 50px auto;
            padding: 60px 20px;
            max-width: 1000px;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-shadow: 0 0 8px rgba(0,0,0,0.05);
        }

        .form-box label {
            display: block;
            font-weight: bold;
            margin-top: 16px;
        }

        .form-box input[type="text"],
        .form-box input[type="email"],
        .form-box input[type="date"],
        .form-box textarea {
            width: 98%;
            padding: 8px;
            margin-top: 4px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
        }

        .form-box button {
            margin-top: 24px;
            padding: 10px 18px;
            background-color: #103254;
            color: white;
            border: none;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
        }

        .form-box button:hover {
            background-color: #103254;
        }
    </style>
</head>
<body>

<div th:replace="~{fragments/header :: header(role=${role})}"></div>

<div class="form-box">
    <h2>공고 수정하기</h2>

    <form th:action="@{/job/{id}/edit(id=${job.id})}" method="post" th:object="${job}" onsubmit="return validateForm();">
        <label>관심 직무</label>
        <input type="hidden" th:field="*{job.occupationId}" id="occupationId" />
        <div id="react-job-category-selector" th:attr="data-initial-id=${job.occupationId}"></div>

        <label>제목</label>
        <input type="text" th:field="*{job.title}" required />
        <div th:if="${#fields.hasErrors('title')}" class="error-message" th:errors="*{job.title}"></div>

        <label>설명</label>
        <textarea th:field="*{job.description}" rows="3" required></textarea>
        <div th:if="${#fields.hasErrors('description')}" class="error-message" th:errors="*{job.description}"></div>

        <label>근무지</label>
        <input type="text" th:field="*{job.address}" required />
        <div th:if="${#fields.hasErrors('address')}" class="error-message" th:errors="*{job.address}"></div>

        <label>주요 업무</label>
        <textarea th:field="*{job.mainTask}" rows="2" required></textarea>
        <div th:if="${#fields.hasErrors('mainTask')}" class="error-message" th:errors="*{job.mainTask}"></div>

        <label>필요 기술</label>
        <textarea th:field="*{job.requiredSkills}" rows="2" required></textarea>
        <div th:if="${#fields.hasErrors('requiredSkills')}" class="error-message" th:errors="*{job.requiredSkills}"></div>

        <label>필요 성향</label>
        <textarea th:field="*{job.requiredTraits}" rows="2" required></textarea>
        <div th:if="${#fields.hasErrors('requiredTraits')}" class="error-message" th:errors="*{job.requiredTraits}"></div>

        <input type="hidden" th:field="*{job.latitude}" th:value="${job.latitude != null ? job.latitude : 37.5665}" />
        <input type="hidden" th:field="*{job.longitude}" th:value="${job.longitude != null ? job.longitude : 126.9780}" />

        <label>기술 키워드</label>
        <input type="text" th:field="*{job.skillKeywords}" />
        <div th:if="${#fields.hasErrors('skillKeywords')}" class="error-message" th:errors="*{job.skillKeywords}"></div>

        <label>성향 키워드</label>
        <input type="text" th:field="*{job.traitKeywords}" />
        <div th:if="${#fields.hasErrors('traitKeywords')}" class="error-message" th:errors="*{job.traitKeywords}"></div>

        <label>채용 시작일</label>
        <input type="date" th:field="*{job.startDate}" required />
        <div th:if="${#fields.hasErrors('startDate')}" class="error-message" th:errors="*{job.startDate}"></div>

        <label>채용 마감일</label>
        <input type="date" th:field="*{job.endDate}" required />
        <div th:if="${#fields.hasErrors('endDate')}" class="error-message" th:errors="*{job.endDate}"></div>

        <label>지원 이메일</label>
        <input type="email" th:field="*{job.enrollEmail}" required />
        <div th:if="${#fields.hasErrors('enrollEmail')}" class="error-message" th:errors="*{job.enrollEmail}"></div>

        <label>유의사항</label>
        <textarea th:field="*{job.notice}" rows="2"></textarea>

        <div style="margin-top: 24px;">
            <button type="submit">수정</button>
            <button type="button" onclick="location.href='/job/manage-jobs'">목록으로</button>
        </div>
    </form>
</div>

<!-- 공통 스크립트 -->
<script th:src="@{/js/dropdown.js}"></script>
<script th:src="@{/js/logout.js}"></script>

<!-- React 로딩 및 Occupation ID 세팅 -->
<script type="module">
    import React from "https://cdn.jsdelivr.net/npm/react@18.2.0/+esm";
    import { createRoot } from "https://cdn.jsdelivr.net/npm/react-dom@18.2.0/client/+esm";

    window.React = React;
    window.createRoot = createRoot;

    document.addEventListener('DOMContentLoaded', () => {
        const initialId = document.getElementById('react-job-category-selector')?.dataset?.initialId;
        if (initialId) {
            document.getElementById('occupationId').value = initialId;
        }

        window.setOccupationId = function (id) {
            document.getElementById('occupationId').value = id;
        };
    });
</script>

<!-- React 직무 셀렉터 -->
<script type="module" src="/js/JobCategorySelector.js"></script>

<!-- 유효성 검사 -->
<script>
    function validateForm() {
        const occId = document.getElementById('occupationId').value;
        if (!occId) {
            alert("관심 직무를 선택해주세요.");
            return false;
        }
        return true;
    }
</script>

</body>
</html>