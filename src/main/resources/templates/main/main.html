<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="https://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8"/>
    <title>MatchingBot</title>
    <link rel="stylesheet" th:href="@{/css/layout.css}"/>
    <style>
        .search-filters {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background-color: #f2f2f2;
            border-radius: 8px;
        }

        .search-filters label {
            margin-right: 20px;
        }
    </style>
</head>
<body>
<!--í™•ì¸ìš©-->
<!--<p th:text="'í˜„ì¬ userType: ' + ${userType}"></p>-->
<!-- Header Fragment -->
<div class="wrapper">
    <div th:replace="~{fragments/header :: header(role=${role})}"></div>

    <main class="main-content">
        <div sec:authorize="hasRole('ADMIN')">
            <h2 style="text-align: center">í™˜ì˜í•©ë‹ˆë‹¤ ê´€ë¦¬ìë‹˜</h2>
        </div>

        <div sec:authorize="!hasRole('ADMIN')">
            <!-- ê²€ìƒ‰ ë°” -->
            <section class="search-bar">
                <input type="text" id="search-input" placeholder="ì±„ìš© ê³µê³  ê²€ìƒ‰"/>
                <button type="button" id="search-button">ğŸ”</button>
            </section>

            <!-- âœ… í•„í„° ì˜ì—­ -->
            <section class="search-filters" id="search-filters">
                <label>
                    ì§ë¬´:
                    <select id="filter-title">
                        <option value="">ì „ì²´</option>
                        <option value="ë°±ì—”ë“œ ê°œë°œì">ë°±ì—”ë“œ ê°œë°œì</option>
                        <option value="í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì">í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì</option>
                        <option value="QA ì—”ì§€ë‹ˆì–´">QA ì—”ì§€ë‹ˆì–´</option>
                        <option value="ì†Œí”„íŠ¸ì›¨ì–´ ì—”ì§€ë‹ˆì–´">ì†Œí”„íŠ¸ì›¨ì–´ ì—”ì§€ë‹ˆì–´</option>
                        <option value="ì‹œìŠ¤í…œ ê´€ë¦¬ì">ì‹œìŠ¤í…œ ê´€ë¦¬ì</option>
                        <option value="UX ë””ìì´ë„ˆ">UX ë””ìì´ë„ˆ</option>
                        <option value="IT ê¸°íšì">IT ê¸°íšì</option>
                        <option value="ë°ì´í„° ë¶„ì„ê°€">ë°ì´í„° ë¶„ì„ê°€</option>
                    </select>
                </label>

                <label>
                    ê°œë°œ ì–¸ì–´:
                    <select id="filter-skill">
                        <option value="">ì „ì²´</option>
                        <option value="Java">Java</option>
                        <option value="Python">Python</option>
                        <option value="React">React</option>
                        <option value="HTML">HTML</option>
                        <option value="CSS">CSS</option>
                        <option value="Linux">Linux</option>
                        <option value="Docker">Docker</option>
                        <option value="Node.js">Node.js</option>
                        <option value="Excel">Excel</option>
                        <option value="PowerPoint">PowerPoint</option>
                        <option value="JUnit">JUnit</option>
                        <option value="Selenium">Selenium</option>
                        <option value="Figma">Figma</option>
                        <option value="Adobe XD">Adobe XD</option>
                    </select>
                </label>

                <label>
                    ì‚¬ëŠ” ì§€ì—­:
                    <select id="filter-region">
                        <option value="">ì „ì²´</option>
                        <option value="ë¶€ì‚°">ë¶€ì‚°</option>
                        <option value="ì„œìš¸">ì„œìš¸</option>
                        <option value="ê°•ë‚¨">ê°•ë‚¨</option>
                        <option value="íŒêµ">íŒêµ</option>
                    </select>
                </label>
            </section>

            <!-- í•„í„° ë²„íŠ¼ ì˜ì—­ -->
            <section class="filter-buttons">
                <button type="button" id="openMapButton">
                    ğŸ“ ë‚´ ì£¼ë³€ ì±„ìš© ê³µê³  ë³´ê¸°
                </button>
                <button type="button">
                    ğŸ“… ì±„ìš© ê³µê³  ë‹¬ë ¥ ë³´ê¸°
                </button>
            </section>

  <!-- ì±„ìš©ê³µê³  ëª©ë¡ -->
  <section class="job-section">
    <h2>ì‹¤ì‹œê°„ ì±„ìš©ì •ë³´</h2>
    <div class="job-list">
      <div th:each="job : ${jobList}" class="job-card">
        <h3 th:text="${job.title}">ì±„ìš©ê³µê³  ì œëª©</h3>
        <p><strong>íšŒì‚¬ëª…:</strong> <span th:text="${job.companyName}">íšŒì‚¬ëª…</span></p>
        <p><strong>ì£¼ì†Œ:</strong> <span th:text="${job.address}">ì£¼ì†Œ</span></p>
        <p><strong>ìš”êµ¬ ê¸°ìˆ :</strong> <span th:text="${job.requiredSkills}">ê¸°ìˆ ìŠ¤íƒ</span></p>
        <a th:href="@{'/job/detail/' + ${job.id}}">ìƒì„¸ë³´ê¸°</a>
      </div>
    </div>

    <!-- âœ… í˜ì´ì§€ë„¤ì´ì…˜ -->
    <div class="pagination">
      <a th:if="${currentPage > 1}" th:href="@{'/main?page=' + ${currentPage - 1}}">ì´ì „</a>
      <span th:text="'í˜„ì¬ í˜ì´ì§€: ' + ${currentPage} + ' / ' + ${totalPages}"></span>
      <a th:if="${currentPage < totalPages}" th:href="@{'/main?page=' + ${currentPage + 1}}">ë‹¤ìŒ</a>
    </div>
  </section>


    <!-- Footer Fragment -->
    <div th:insert="~{fragments/footer :: footer}"></div>
</div>
<!-- íŒì—… ë° í•„í„° ìŠ¤í¬ë¦½íŠ¸ -->
<script>
    window.onload = function () {
        // ì§€ë„ íŒì—… ë²„íŠ¼
        const mapBtn = document.getElementById("openMapButton");
        if (mapBtn) {
            mapBtn.addEventListener("click", function () {
                window.open('/map_popup', 'mapPopup', 'width=800,height=600');
            });
        }

        // í•„í„° ì˜ì—­ ì—´ê¸°
        const searchInput = document.getElementById("search-input");
        const filterSection = document.getElementById("search-filters");
        searchInput.addEventListener("focus", () => {
            filterSection.style.display = "block";
        });

        // ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì‹œ í•„í„° ìˆ˜ì§‘
        document.getElementById("search-button").addEventListener("click", () => {
            const keyword = document.getElementById("search-input").value;
            const title = document.getElementById("filter-title").value;
            const skill = document.getElementById("filter-skill").value;
            const region = document.getElementById("filter-region").value;

            console.log("ê²€ìƒ‰ ì¡°ê±´:", {
                keyword,
                title,
                skill,
                region
            });

      // ì„œë²„ì— ìš”ì²­ ë˜ëŠ” í˜ì´ì§€ ì´ë™
       window.location.href = `/search-page?keyword=${keyword}&title=${title}&skill=${skill}&region=${region}`;
    });
  };
</script>
<!--í—¤ë” ì¶”ê°€í• ë•Œ dropdown & logout.jsì¶”ê°€-->
<script th:src="@{/js/dropdown.js}"></script>
<script th:src="@{/js/logout.js}"></script>
</body>
</html>
