<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="https://www.thymeleaf.org/extras/spring-security">
<head>
  <meta charset="UTF-8"/>
  <title>MatchingBot | ì´ë ¥ì„œ ëª©ë¡</title>

  <!-- âœ… Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" th:href="@{/css/layout.css}"/>

  <style>
    .card {
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.06);
      margin-bottom: 20px;
      height: 300px; /* ê³ ì • ë†’ì´ */
      display: flex;
      flex-direction: column;
    }

    .card-body {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .card-title,
    .card-text,
    .meta-text span {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      display: block;
    }

    .meta-text {
      font-size: 0.9rem;
      color: #777;
    }

    .card-text {
      font-size: 1rem;
      color: #555;
    }

    .card-title {
      font-size: 1.2rem;
      font-weight: bold;
    }
  </style>

</head>
<body>

<div class="wrapper">
  <div th:replace="~{fragments/header :: header(role=${role})}"></div>

  <main class="main-content container py-5">
    <h2 class="text-center mb-4">ì§€ì›ì ì´ë ¥ì„œ ëª©ë¡</h2>

    <!-- âœ… ê²€ìƒ‰ì°½ -->
    <section class="text-center mb-4">
      <input type="text" id="search-input" placeholder="ì´ë ¥ì„œ ê²€ìƒ‰" class="form-control d-inline-block w-50"/>
      <button type="button" id="search-button" class="btn btn-primary ms-2">ğŸ” ê²€ìƒ‰</button>
    </section>

    <!--    &lt;!&ndash; âœ… ì‹ ì…/ê²½ë ¥ í•„í„° ì˜ì—­ &ndash;&gt;-->
    <!--    <section id="search-filters" class="text-center mb-4" style="display: none;">-->
    <!--      <label><strong>ê²½ë ¥ ìœ í˜•:</strong></label>-->
    <!--      <div id="react-career-type-selector" class="my-2 d-inline-block"></div>-->
    <!--      <input type="hidden" id="filter-career-type" />-->
    <!--    </section>-->
    <!-- âœ… í•„í„° ì˜ì—­ -->
    <section class="search-filters text-center" id="search-filters">
      <!--      <label><strong>ì§ë¬´ ì„ íƒ:</strong></label>-->
      <!--      <div id="react-job-category-selector" class="mb-2"></div>-->
      <!--      <input type="hidden" id="filter-job-group" name="jobGroup"/>-->
      <!--      <input type="hidden" id="filter-job-type" name="jobType"/>-->
      <!--      <input type="hidden" id="filter-job-role" name="jobRole"/>-->
<!--      <label><strong>ê²½ë ¥ ì„ íƒ:</strong></label>-->
      <!-- í•„í„° ì˜ì—­ -->
<!--      <div id="react-career-type-selector"></div>-->

      <!-- form ë‚´ë¶€ ìˆ¨ê²¨ì§„ ê°’ -->
<!--      <input type="hidden" name="careerType" id="filter-career-type" value="">-->



<!--    &lt;!&ndash; âœ… ì‹ ì…/ê²½ë ¥ í•„í„° ì˜ì—­ &ndash;&gt;-->
<!--    <section id="search-filters" class="text-center mb-4" style="display: none;">-->
<!--      <label><strong>ê²½ë ¥ ìœ í˜•:</strong></label>-->
<!--      <div id="react-career-type-selector" class="my-2 d-inline-block"></div>-->
<!--      <input type="hidden" id="filter-career-type" />-->
<!--    </section>-->
    <!-- âœ… í•„í„° ì˜ì—­ -->
<!--    <section class="search-filters text-center" id="search-filters">-->
<!--      <label><strong>ì§ë¬´ ì„ íƒ:</strong></label>-->
<!--      <div id="react-job-category-selector" class="mb-2"></div>-->
<!--      <input type="hidden" id="filter-job-group" name="jobGroup"/>-->
<!--      <input type="hidden" id="filter-job-type" name="jobType"/>-->
<!--      <input type="hidden" id="filter-job-role" name="jobRole"/>-->
<!--      <label><strong>ê²½ë ¥ ì„ íƒ:</strong></label>-->
      <!-- í•„í„° ì˜ì—­ -->
      <div id="react-career-type-selector"></div>

      <!-- form ë‚´ë¶€ ìˆ¨ê²¨ì§„ ê°’ -->
      <input type="hidden" name="careerType" id="filter-career-type" value="">

      <!-- âœ… ì±„ìš©ê³µê³  ì„ íƒ ë“œë¡­ë‹¤ìš´ (role == COMPANY ì¼ ë•Œë§Œ í‘œì‹œ) -->
      <div class="d-flex align-items-center justify-content-center flex-wrap mb-4" style="gap: 10px;">
        <!-- ë“œë¡­ë‹¤ìš´ -->
        <div th:if="${role == 'COMPANY'}" class="d-flex align-items-center">
          <label for="jobSelectMain" class="me-2 mb-0"><strong>ê³µê³  ì„ íƒ:</strong></label>
          <select id="jobSelectMain" name="jobId" class="form-select" style="height: 38px; width: auto;">
            <option value="" disabled selected>ë§¤ì¹­ë¥  í•„í„°ë¥¼ ì ìš©í•  ê³µê³ ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
            <option th:each="job : ${jobs}"
                    th:value="${job.id}"
                    th:text="${job.title}">ê³µê³  ì œëª©
            </option>
          </select>
        </div>
      </div>

    </section>
    <!-- âœ… ì´ë ¥ì„œ ì¹´ë“œ ëª©ë¡ -->
    <div class="row">
      <div class="col-md-4" th:each="resume : ${resumeList}">
        <div class="card h-100 resume-card" th:onclick="|location.href='@{/resume/detail/{id}(id=${resume.id})}'|" style="cursor: pointer;">
          <div class="card-body">
            <div class="resume-card-header">
              <h5 class="card-title" th:text="${resume.memberName} ?: 'ì´ë¦„ ì—†ìŒ'">ì§€ì›ì ì´ë¦„</h5>
              <button
                      class="stared-button"
                      th:classappend="${resume.bookmarked} ? 'filled' : ''"
                      th:data-resume-id="${resume.id}"
                      onclick="toggleStar(this, event)"
                      sec:authorize="hasRole('COMPANY')">
                <span th:text="${resume.bookmarked} ? 'â˜…' : 'â˜†'">â˜†</span>
              </button>
            </div>
            <p class="card-text"><strong>ì´ë ¥ì„œ ì œëª©:</strong> <span th:text="${resume.title} ?: 'ì œëª© ì—†ìŒ'"></span></p>
            <p class="card-text"><strong>ê¸°ìˆ  ì†Œê°œ:</strong> <span th:text="${resume.skillAnswer} ?: 'ê¸°ìˆ  ì†Œê°œ ì—†ìŒ'"></span></p>
            <p class="card-text"><strong>ì„±í–¥ ì†Œê°œ:</strong> <span th:text="${resume.traitAnswer} ?: 'ì„±í–¥ ì†Œê°œ ì—†ìŒ'"></span></p>
            <p class="card-text"><strong>ê¸°ìˆ  í‚¤ì›Œë“œ:</strong> <span th:text="${resume.skillKeywords} ?: 'ê¸°ìˆ  í‚¤ì›Œë“œ ì—†ìŒ'"></span></p>
            <p class="card-text"><strong>ì‘ì„±ì¼:</strong> <span th:text="${#temporals.format(resume.createdAt, 'yyyy-MM-dd')} ?: 'ì‘ì„±ì¼ ì—†ìŒ'"></span></p>
          </div>
        </div>
      </div>
    </div>

    <!-- âœ… í˜ì´ì§• -->
    <!-- âœ… í˜ì´ì§• -->
    <nav class="mt-4">
      <ul class="pagination justify-content-center">

        <!-- ì´ì „ ë²„íŠ¼ -->
        <li class="page-item" th:classappend="${currentPage == 1} ? 'disabled'">
          <a class="page-link"
             th:if="${currentPage > 1}"
             th:href="@{/resumes(page=${currentPage - 1})}">ì´ì „</a>
          <span class="page-link" th:if="${currentPage == 1}">ì´ì „</span>
        </li>

        <!-- í˜ì´ì§€ ë²ˆí˜¸ 5ê°œì”© -->
        <li class="page-item"
            th:each="i : ${#numbers.sequence(((currentPage - 1) / 10 * 10 + 1), T(java.lang.Math).min(((currentPage - 1) / 10 * 10 + 10), totalPages))}"
            th:classappend="${currentPage == i} ? 'active'">
          <a class="page-link" th:href="@{/resumes(page=${i})}" th:text="${i}">1</a>
        </li>

        <!-- ë‹¤ìŒ ë²„íŠ¼ -->
        <li class="page-item" th:classappend="${currentPage == totalPages} ? 'disabled'">
          <a class="page-link"
             th:if="${currentPage < totalPages}"
             th:href="@{/resumes(page=${currentPage + 1})}">ë‹¤ìŒ</a>
          <span class="page-link" th:if="${currentPage == totalPages}">ë‹¤ìŒ</span>
        </li>

      </ul>
    </nav>



  </main>

  <div th:replace="~{fragments/footer :: footer(role=${role})}"></div>
</div>

 âœ… ê²€ìƒ‰ ìŠ¤í¬ë¦½íŠ¸
<!--<script>-->
<!--  window.onload = function () {-->
<!--    const searchInput = document.getElementById("search-input");-->
<!--    const filterSection = document.getElementById("search-filters");-->
<!--    if (searchInput && filterSection) {-->
<!--      searchInput.addEventListener("focus", () => {-->
<!--        filterSection.style.display = "block";-->
<!--      });-->
<!--    }-->


<!--    document.getElementById("search-button").addEventListener("click", () => {-->
<!--      // const companyName = document.getElementById("search-input").value;-->
<!--      // const jobGroup = document.getElementById("filter-job-group").value;-->
<!--      // const jobType = document.getElementById("filter-job-type").value;-->
<!--      // const jobRole = document.getElementById("filter-job-role").value;-->
<!--      const careerType = document.getElementById("filter-career-type").value;-->

<!--      const query = new URLSearchParams({-->
<!--        // companyName: companyName || '',-->
<!--        careerType: careerType || ''-->
<!--        // jobGroup: jobGroup || '',-->
<!--        // jobType: jobType || '',-->
<!--        // jobRole: jobRole || ''-->
<!--      }).toString();-->

<!--      window.location.href = `/member-resume?${query}`;-->
<!--    });-->
<!--  };-->
<!--</script>-->

<!-- âœ… React ëª¨ë“ˆ -->
<script th:src="@{/js/dropdown.js}"></script>
<script th:src="@{/js/logout.js}"></script>

<!-- âœ… React ì„¤ì • -->
<script type="module">
  import React from "https://cdn.jsdelivr.net/npm/react@18.2.0/+esm";
  import {createRoot} from "https://cdn.jsdelivr.net/npm/react-dom@18.2.0/client/+esm";


</script>

<!-- âœ… ê²½ë ¥ í•„í„° React ì»´í¬ë„ŒíŠ¸ -->
<script type="module" src="/js/JobCategorySelector.js"></script>
<script type="module" src="/js/CareerTypeSelector.js"></script>
<!--<script type="module" src="/js/CareerTypeSelector.js"></script>-->
<!--window.React = React;-->
<!--window.createRoot = createRoot;-->
<!--    </script>-->
<!--  </main>-->

<!--<div th:replace="~{fragments/footer :: footer}"></div>-->

<!-- ì´ë ¥ì„œ ì¦ê²¨ì°¾ê¸° -->
<script>
  function toggleStar(button, event) {
    event.stopPropagation();
    const resumeId = button.dataset.resumeId;

    fetch(`/job/resume-bookmark/toggle?resumeId=${resumeId}`, {
      method: 'POST'
    })
            .then(response => {
              if (!response.ok) throw new Error("ì¦ê²¨ì°¾ê¸° ì‹¤íŒ¨");
              return response.json();
            })
            .then(data => {
              const icon = button.querySelector('span');

              if (data.bookmarked) {
                button.classList.add('filled');
                icon.textContent = 'â˜…';
                alert('ì´ë ¥ì„œê°€ ì¦ê²¨ì°¾ê¸° ë˜ì—ˆìŠµë‹ˆë‹¤.');
              } else {
                button.classList.remove('filled');
                icon.textContent = 'â˜†';
                alert('ì¦ê²¨ì°¾ê¸°ê°€ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
              }
            })
            .catch(error => {
              console.error(error);
              alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            });
  }

</script>
<!--// 0610-->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const jobSelect = document.getElementById("jobSelectMain");
    if (!jobSelect) return;

    jobSelect.addEventListener("change", async () => {
      const jobId = jobSelect.value;
      if (!jobId) return;

      try {
        const response = await fetch(`/api/v1/resume/sort-resumes-by-job`, {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({jobId: jobId})
        });

        if (response.ok) {
          const sortedResumes = await response.json();

          // âœ… ì •ë ¬ëœ ê³µê³ ë“¤ë¡œ DOM ê°±ì‹ 
          const container = document.querySelector(".row");
          container.innerHTML = ""; // ê¸°ì¡´ ê³µê³  ì œê±°

          sortedResumes.forEach(resume => {
            const card = document.createElement("div");
            card.className = "col-md-4";
            card.innerHTML = `
                        <div class="card h-100 resume-card" style="cursor: pointer;" onclick="location.href='/resume/detail/${resume.id}'">
                          <div class="card-body">
                            <div class="resume-card-header">
                              <h5 class="card-title">${resume.memberName}</h5>
                              <button class="stared-button ${resume.bookmarked ? 'filled' : ''}"
                                      data-resume-id="${resume.id}"
                                      onclick="toggleStar(this, event)">
                                <span>${resume.bookmarked ? 'â˜…' : 'â˜†'}</span>
                              </button>
                            </div>
                            <p class="card-text"><strong>ì´ë ¥ì„œ ì œëª©:</strong> ${resume.title}</p>
                            <p class="card-text"><strong>ê¸°ìˆ  ì†Œê°œ:</strong> ${resume.skillAnswer}</p>
                            <p class="card-text"><strong>ì„±í–¥ ì†Œê°œ:</strong> ${resume.traitAnswer}</p>
                            <p class="card-text"><strong>ê¸°ìˆ  í‚¤ì›Œë“œ:</strong> ${resume.skillKeywords}</p>
                            <p class="card-text"><strong>ì‘ì„±ì¼:</strong> ${resume.createdAt}</p>
                          </div>
                        </div>
            `;
            container.appendChild(card);
          });

        } else {
          alert("ë§¤ì¹­ë¥  ì •ë ¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        }
      } catch (e) {
        console.error("ì •ë ¬ ì˜¤ë¥˜:", e);
      }
    });
  });
</script>

<script th:src="@{/js/logout.js}"></script>

</body>
</html>
