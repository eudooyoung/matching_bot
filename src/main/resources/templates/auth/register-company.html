<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>기업 회원가입</title>
    <link rel="stylesheet" type="text/css" href="/css/register.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<div class="container">
    <h2>기업 회원가입</h2>

    <form id="companyForm">
        <!-- 1. 기본 정보 입력 -->
        <div>
            <label>* Email</label><br>
            <input type="email" name="email" required><br>

            <label>* 비밀번호</label><br>
            <input type="password" name="password" required><br>

            <label>* 회사명</label><br>
            <input type="text" name="companyName" required><br>
        </div>

        <!-- 2. 사업자등록번호 -->
        <div>
            <label>* 사업자등록번호</label><br>
            <input type="text" id="license" name="license" required>
            <button type="button" onclick="businessNumber()">인증</button>
            <div id="regimessage" style="color: green;"></div>
        </div>

        <!-- 3. 주소 -->
        <div>
            <label>* 주소</label><br>
            <input type="text" name="address" required>
        </div>

        <!-- 5. 추가 기업 정보 -->
        <div>
            <label>설립연도</label><br>
            <input type="number" name="establishedYear"><br>

            <label>직원수</label><br>
            <input type="number" name="employeeCount"><br>

            <label>연매출 (원)</label><br>
            <input type="number" name="annualSales"><br>

            <label>영업이익 (원)</label><br>
            <input type="number" name="operatingProfit"><br>

            <label>최근 1년 채용공고 수</label><br>
            <input type="number" name="recentJobPosts"><br>
        </div>

        <!-- 6. 약관동의 체크박스 -->
        <div>
            <h4>* 약관 동의</h4>
            <label><input type="checkbox" required> [필수] 서비스 이용약관 동의</label><br>
            <label><input type="checkbox" required> [필수] 정보 수집 및 이용 동의</label><br>
            <label><input type="checkbox" required> [필수] 정보 제공 동의</label><br>
            <label><input type="checkbox"> [선택] 추가 정보 동의 (OPEN API 포함)</label><br>
            <label><input type="checkbox"> [선택] 마케팅 정보 수신 동의</label><br>
            <label><input type="checkbox"> [선택] 제3자 정보 제공 동의</label><br>
        </div>

        <button type="button" onclick="businessRegi()">다음으로</button>
    </form>
</div>

<script>
    function businessNumber() {
        let num = document.getElementById('license').value;
        const data = { "b_no": [num] };
        $.ajax({
            url: "https://api.odcloud.kr/api/nts-businessman/v1/status?serviceKey=twO9sqDfhrgll63lHHuzhS7YQD9w%2BmsuiEtGs81kTg21FgTKxr9FIcdLwxFosSoawgSA5TFpr0qSy1Ike9IZdg%3D%3D",
            type: "POST",
            data: JSON.stringify(data),
            dataType: "JSON",
            contentType: "application/json",
            success: function(result) {
                let valid = result.data[0]['b_stt_cd'];
                let msg = document.getElementById('regimessage');
                msg.innerHTML = valid === '01' ? "<br>사업자 회원가입이 가능합니다." : "<br>사업자 회원가입을 할 수 없습니다.";
            },
            error: function(err) {
                console.log(err.responseText);
            }
        });
    }

    function businessRegi() {
        let num = document.getElementById('license').value;
        const data = { "b_no": [num] };
        $.ajax({
            url: "https://api.odcloud.kr/api/nts-businessman/v1/status?serviceKey=twO9sqDfhrgll63lHHuzhS7YQD9w%2BmsuiEtGs81kTg21FgTKxr9FIcdLwxFosSoawgSA5TFpr0qSy1Ike9IZdg%3D%3D",
            type: "POST",
            data: JSON.stringify(data),
            dataType: "JSON",
            contentType: "application/json",
            success: function(result) {
                let valid = result.data[0]['b_stt_cd'];
                if (valid === '01') {
                    alert("사업자 인증에 성공했습니다.");
                    window.location.href = "/auth/register";  // 다음 페이지 이동
                } else {
                    alert("사업자가 아닙니다.");
                }
            },
            error: function() {
                alert("인증 처리 중 에러 발생");
            }
        });
    }
</script>

</body>
</html>