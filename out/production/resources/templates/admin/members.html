<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="https://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8"/>
    <title>MatchingBot</title>
    <link rel="stylesheet" th:href="@{/css/layout.css}"/>
    <link rel="stylesheet" th:href="@{/css/admin-members.css}"/>
</head>
<body>

<div class="wrapper">
    <div th:replace="~{fragments/header :: header(role=${role})}"></div>

    <main class="main-content">
        <section style="padding: 2rem;">
            <h2 style="margin-bottom: 1.5rem;">개인 회원 관리</h2>

            <!-- 검색창 -->
            <table class="search-bar-table" style="margin-bottom: 1rem;">
                <thead>
                <tr>
                    <th colspan="4">
                        <form method="get" th:action="@{/admin/members}"
                              style="display: flex; gap: 1rem; align-items: center;">
                            <!-- 이름/이메일 키워드 -->
                            <input type="text" name="keyword" placeholder="이름, 이메일 검색..."
                                   th:value="${cond.keyword}" style="padding: 0.5rem; width: 200px;"/>

                            <!-- 상태 -->
                            <select name="status" style="padding: 0.5rem;">
                                <option value="">전체</option>
                                <option value="Y" th:selected="${cond.status == 'Y'}">ACTIVE</option>
                                <option value="N" th:selected="${cond.status == 'N'}">INACTIVE</option>
                            </select>

                            <!-- 정렬 기준 -->
                            <select name="sortBy" style="padding: 0.5rem;">
                                <option value="id" th:selected="${cond.sortBy == 'id'}">회원 번호</option>
                                <option value="createdAt" th:selected="${cond.sortBy == 'createdAt'}">가입일</option>
                            </select>

                            <!-- 정렬 방향 -->
                            <select name="direction" style="padding: 0.5rem;">
                                <option value="DESC" th:selected="${cond.direction == 'DESC'}">내림차순</option>
                                <option value="ASC" th:selected="${cond.direction == 'ASC'}">오름차순</option>
                            </select>

                            <!-- 버튼 -->
                            <button type="submit"
                                    style="padding: 0.5rem 1rem; background-color: #2196f3; color: white; border: none; border-radius: 4px;">
                                검색
                            </button>
                        </form>
                    </th>
                </tr>
                </thead>
            </table>

            <!-- 회원 테이블 -->
            <table class="table">
                <thead style="background-color: #f0f0f0;">
                <tr>
                    <th>회원 번호</th>
                    <th>이름</th>
                    <th>이메일</th>
                    <th>성별</th>
                    <th>연락처</th>
                    <th>약관 동의</th>
                    <th>개인정보 동의</th>
                    <th>가입일</th>
                    <th>수정자</th>
                    <th>수정일</th>
                    <th>상태</th>
                    <th>삭제</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="member : ${members}">
                    <td th:text="${member.formattedId}">아이디</td>
                    <td th:text="${member.name}">이름</td>
                    <td>
                        <a th:href="@{|/admin/members/${member.id}|}"
                           th:text="${member.email}"
                           class="email-link">이메일</a>
                    </td>
                    <td th:text="${member.getGenderLabel()}">성별</td>
                    <td th:text="${member.phone}">010-1234-5678</td>
                    <td th:text="${member.getPrivacyLabel()}">동의</td>
                    <td th:text="${member.getServiceLabel()}">동의</td>
                    <td th:text="${#temporals.format(member.createdAt, 'yyyy-MM-dd HH:mm:ss')}">가입일</td>
                    <td th:text="${member.updatedBy}">수정자</td>
                    <td th:text="${#temporals.format(member.updatedAt, 'yyyy-MM-dd HH:mm:ss')}">2025-04-10</td>
                    <td th:class="${member.getStatusClass()}"
                        th:text="${member.getStatusText()}">
                        상태
                    </td>
                    <td>
                        <button type="button"
                                class="btn-delete"
                                th:if="${member.status.name() == 'Y'}"
                                th:onclick="|deactivateItem({ id: ${member.id}, url: '/api/v1/admin/members', onSuccess: () => location.reload() })|">
                            삭제
                        </button>

                        <button type="button"
                                class="btn-restore"
                                th:if="${member.status.name() == 'N'}"
                                th:onclick="|reactivateItem({ id: ${member.id}, url: '/api/v1/admin/members', onSuccess: () => location.reload() })|">
                            복구
                        </button>
                    </td>
                </tr>
                </tbody>
            </table>

            <!-- 페이지네이션 (예시) -->
            <div class="table-pagination" style="margin-top: 1.5rem; text-align: center;">
                <a th:if="${page.hasPrevious()}" th:href="@{/admin/members(page=${currentPage - 1})}">이전</a>
                <span th:unless="${page.hasPrevious()}" style="visibility: hidden;">이전</span>

                <span th:each="pageNum : ${pageNumbers}" style="margin: 0 5px;">
                    <a th:href="@{/admin/members(page=${pageNum})}"
                       th:text="${pageNum + 1}"
                       th:classappend="${pageNum == currentPage} ? 'active-page' : ''"></a>
                </span>

                <a th:if="${page.hasNext()}" th:href="@{/admin/members(page=${currentPage + 1})}">다음</a>
                <span th:unless="${page.hasNext()}" style="visibility: hidden;">다음</span>
            </div>
        </section>
    </main>

    <!-- Footer Fragment -->
    <div th:replace="~{fragments/footer :: footer}"></div>
</div>
<script th:src="@{/js/dropdown.js}"></script>
<script th:src="@{/js/logout.js}"></script>
<script th:src="@{/js/admin/deactivate.js}"></script>
<script th:src="@{/js/admin/reactivate.js}"></script>
<script th:src="@{/js/fetchWithAuth.js}"></script>
</body>
</html>
