<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="https://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8"/>
    <title>MatchingBot</title>
    <link rel="stylesheet" th:href="@{/css/layout.css}"/>
    <style>
        .search-filters {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background-color: #f2f2f2;
            border-radius: 8px;
        }

        .search-filters label {
            margin-right: 20px;
        }
    </style>
</head>
<body>
<!--확인용-->
<!--<p th:text="'현재 userType: ' + ${userType}"></p>-->
<!-- Header Fragment -->
<div class="wrapper">
    <div th:replace="~{fragments/header :: header(role=${role})}"></div>

    <main class="main-content">
        <div sec:authorize="hasRole('ADMIN')">
            <h2 style="text-align: center">환영합니다 관리자님</h2>
        </div>

        <div sec:authorize="!hasRole('ADMIN')">
            <!-- 검색 바 -->
            <section class="search-bar">
                <input type="text" id="search-input" placeholder="채용 공고 검색"/>
                <button type="button" id="search-button">🔍</button>
            </section>

            <!-- ✅ 필터 영역 -->
            <section class="search-filters" id="search-filters">

                <label><strong>직무 선택:</strong></label>
                <div id="react-job-category-selector"></div>

                <label><strong>지역 선택:</strong></label>
                <div id="react-location-selector"></div>
                <input type="hidden" id="filter-region-main" name="region_main">
                <input type="hidden" id="filter-region-sub" name="region_sub">

            </section>

            <!-- 필터 버튼 영역 -->
            <section class="filter-buttons">
                <button type="button" id="openMapButton">
                    📍 내 주변 채용 공고 보기
                </button>
                <button th:onclick="|location.href='@{/calendar}'|">📅 채용 공고 달력 보기</button>
            </section>

  <!-- 채용공고 목록 -->
  <section class="job-section">
    <h2>실시간 채용정보</h2>
    <div class="job-list">
      <div th:each="job : ${jobList}" class="job-card">
        <h3 th:text="${job.title}">채용공고 제목</h3>
        <p><strong>회사명:</strong> <span th:text="${job.companyName}">회사명</span></p>
        <p><strong>주소:</strong> <span th:text="${job.address}">주소</span></p>
        <p><strong>요구 기술:</strong> <span th:text="${job.requiredSkills}">기술스택</span></p>
        <a th:href="@{'/job/detail/' + ${job.id}}">상세보기</a>
      </div>
    </div>

    <!-- ✅ 페이지네이션 -->
    <div class="pagination">
      <a th:if="${currentPage > 1}" th:href="@{'/main?page=' + ${currentPage - 1}}">이전</a>
      <span th:text="'현재 페이지: ' + ${currentPage} + ' / ' + ${totalPages}"></span>
      <a th:if="${currentPage < totalPages}" th:href="@{'/main?page=' + ${currentPage + 1}}">다음</a>
    </div>
  </section>


    <!-- Footer Fragment -->
    <div th:insert="~{fragments/footer :: footer}"></div>
</div>
<!-- 팝업 및 필터 스크립트 -->
<script>
    window.onload = function () {
        // 지도 팝업 버튼
        const mapBtn = document.getElementById("openMapButton");
        if (mapBtn) {
            mapBtn.addEventListener("click", function () {
                window.open('/map_popup', 'mapPopup', 'width=800,height=600');
            });
        }

        // 필터 영역 열기
        const searchInput = document.getElementById("search-input");
        const filterSection = document.getElementById("search-filters");
        searchInput.addEventListener("focus", () => {
            filterSection.style.display = "block";
        });

        // 검색 버튼 클릭 시 필터 수집
        document.getElementById("search-button").addEventListener("click", () => {
            const keyword = document.getElementById("search-input").value;
            const title = document.getElementById("filter-title").value;
            const skill = document.getElementById("filter-skill").value;
            const region = document.getElementById("filter-region").value;

            console.log("검색 조건:", {
                keyword,
                title,
                skill,
                region
            });

      // 서버에 요청 또는 페이지 이동
       window.location.href = `/search-page?keyword=${keyword}&title=${title}&skill=${skill}&region=${region}`;
    });
  };
</script>
<!--헤더 추가할때 dropdown & logout.js추가-->
<script th:src="@{/js/dropdown.js}"></script>
<script th:src="@{/js/logout.js}"></script>
<script type="module">
    import React from "https://cdn.jsdelivr.net/npm/react@18.2.0/+esm";
    import { createRoot } from "https://cdn.jsdelivr.net/npm/react-dom@18.2.0/client/+esm";

    // React 전역 등록 (필요 시 다른 모듈에서 사용 가능하도록)
    window.React = React;
    window.createRoot = createRoot;
</script>
<script type="module" src="/js/JobCategorySelector.js"></script>
<script type="module" src="/js/LocationSelector.js"></script>
</body>
</html>
