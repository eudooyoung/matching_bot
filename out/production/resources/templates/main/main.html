<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="https://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8"/>
    <title>MatchingBot</title>
    <link rel="stylesheet" th:href="@{/css/layout.css}"/>
    <style>
        .search-filters {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background-color: #f2f2f2;
            border-radius: 8px;
        }

        .search-filters label {
            margin-right: 20px;
        }
    </style>
</head>
<body>
<!--í™•ì¸ìš©-->
<!--<p th:text="'í˜„ì¬ userType: ' + ${userType}"></p>-->
<!-- Header Fragment -->
<div class="wrapper">
    <div th:replace="~{fragments/header :: header(role=${role})}"></div>

    <main class="main-content">
        <div sec:authorize="hasRole('ADMIN')">
            <h2 style="text-align: center">í™˜ì˜í•©ë‹ˆë‹¤ ê´€ë¦¬ìë‹˜</h2>
        </div>

        <div sec:authorize="!hasRole('ADMIN')">
            <!-- ê²€ìƒ‰ ë°” -->
            <section class="search-bar">
                <input type="text" id="search-input" placeholder="ì±„ìš© ê³µê³  ê²€ìƒ‰"/>
                <button type="button" id="search-button">ğŸ”</button>
            </section>

            <!-- âœ… í•„í„° ì˜ì—­ -->
            <section class="search-filters" id="search-filters">

                <label><strong>ì§ë¬´ ì„ íƒ:</strong></label>
                <div id="react-job-category-selector"></div>

                <label><strong>ì§€ì—­ ì„ íƒ:</strong></label>
                <div id="react-location-selector"></div>
                <input type="hidden" id="filter-region-main" name="region_main">
                <input type="hidden" id="filter-region-sub" name="region_sub">

            </section>

            <!-- í•„í„° ë²„íŠ¼ ì˜ì—­ -->
            <section class="filter-buttons">
                <button type="button" id="openMapButton">
                    ğŸ“ ë‚´ ì£¼ë³€ ì±„ìš© ê³µê³  ë³´ê¸°
                </button>
                <button th:onclick="|location.href='@{/calendar}'|">ğŸ“… ì±„ìš© ê³µê³  ë‹¬ë ¥ ë³´ê¸°</button>
            </section>

  <!-- ì±„ìš©ê³µê³  ëª©ë¡ -->
  <section class="job-section">
    <h2>ì‹¤ì‹œê°„ ì±„ìš©ì •ë³´</h2>
    <div class="job-list">
      <div th:each="job : ${jobList}" class="job-card">
        <h3 th:text="${job.title}">ì±„ìš©ê³µê³  ì œëª©</h3>
        <p><strong>íšŒì‚¬ëª…:</strong> <span th:text="${job.companyName}">íšŒì‚¬ëª…</span></p>
        <p><strong>ì£¼ì†Œ:</strong> <span th:text="${job.address}">ì£¼ì†Œ</span></p>
        <p><strong>ìš”êµ¬ ê¸°ìˆ :</strong> <span th:text="${job.requiredSkills}">ê¸°ìˆ ìŠ¤íƒ</span></p>
        <a th:href="@{'/job/detail/' + ${job.id}}">ìƒì„¸ë³´ê¸°</a>
      </div>
    </div>

    <!-- âœ… í˜ì´ì§€ë„¤ì´ì…˜ -->
    <div class="pagination">
      <a th:if="${currentPage > 1}" th:href="@{'/main?page=' + ${currentPage - 1}}">ì´ì „</a>
      <span th:text="'í˜„ì¬ í˜ì´ì§€: ' + ${currentPage} + ' / ' + ${totalPages}"></span>
      <a th:if="${currentPage < totalPages}" th:href="@{'/main?page=' + ${currentPage + 1}}">ë‹¤ìŒ</a>
    </div>
  </section>


    <!-- Footer Fragment -->
    <div th:insert="~{fragments/footer :: footer}"></div>
</div>
<!-- íŒì—… ë° í•„í„° ìŠ¤í¬ë¦½íŠ¸ -->
<script>
    window.onload = function () {
        // ì§€ë„ íŒì—… ë²„íŠ¼
        const mapBtn = document.getElementById("openMapButton");
        if (mapBtn) {
            mapBtn.addEventListener("click", function () {
                window.open('/map_popup', 'mapPopup', 'width=800,height=600');
            });
        }

        // í•„í„° ì˜ì—­ ì—´ê¸°
        const searchInput = document.getElementById("search-input");
        const filterSection = document.getElementById("search-filters");
        searchInput.addEventListener("focus", () => {
            filterSection.style.display = "block";
        });

        // ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì‹œ í•„í„° ìˆ˜ì§‘
        document.getElementById("search-button").addEventListener("click", () => {
            const keyword = document.getElementById("search-input").value;
            const title = document.getElementById("filter-title").value;
            const skill = document.getElementById("filter-skill").value;
            const region = document.getElementById("filter-region").value;

            console.log("ê²€ìƒ‰ ì¡°ê±´:", {
                keyword,
                title,
                skill,
                region
            });

      // ì„œë²„ì— ìš”ì²­ ë˜ëŠ” í˜ì´ì§€ ì´ë™
       window.location.href = `/search-page?keyword=${keyword}&title=${title}&skill=${skill}&region=${region}`;
    });
  };
</script>
<!--í—¤ë” ì¶”ê°€í• ë•Œ dropdown & logout.jsì¶”ê°€-->
<script th:src="@{/js/dropdown.js}"></script>
<script th:src="@{/js/logout.js}"></script>
<script type="module">
    import React from "https://cdn.jsdelivr.net/npm/react@18.2.0/+esm";
    import { createRoot } from "https://cdn.jsdelivr.net/npm/react-dom@18.2.0/client/+esm";

    // React ì „ì—­ ë“±ë¡ (í•„ìš” ì‹œ ë‹¤ë¥¸ ëª¨ë“ˆì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡)
    window.React = React;
    window.createRoot = createRoot;
</script>
<script type="module" src="/js/JobCategorySelector.js"></script>
<script type="module" src="/js/LocationSelector.js"></script>
</body>
</html>
